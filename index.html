<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Coral Bleaching Predictor ü™∏</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{
    --bg:#06121a;
    --sea:#0b2a3a;
    --sea2:#0e3d56;
    --card:#0b1420;
    --ink:#eaf6ff;
    --muted:#9ab3c6;
    --accent:#2b84ff;
    --accent2:#2ee6d6;
    --err:#ff5151;
    --good:#2ee6a2;
    --radius:18px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--ink); font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Arial;
    background: radial-gradient(1200px 800px at 70% -10%, #133b5c 0%, var(--bg) 55%);
    overflow-x:hidden;
  }

  /* Floating bubbles */
  .bubble{position:fixed; bottom:-120px; width:12px; height:12px; background:#8fd3ff22; border-radius:50%;
    animation:rise 16s linear infinite; filter:blur(0.3px)}
  .bubble:nth-child(2){left:15%; animation-duration:18s; width:8px; height:8px; animation-delay:2s}
  .bubble:nth-child(3){left:30%; animation-duration:22s; width:14px; height:14px; animation-delay:4s}
  .bubble:nth-child(4){left:55%; animation-duration:20s; width:10px; height:10px; animation-delay:1s}
  .bubble:nth-child(5){left:75%; animation-duration:24s; width:16px; height:16px; animation-delay:3s}
  @keyframes rise{0%{transform:translateY(0) translateX(0)} 100%{transform:translateY(-120vh) translateX(-20px)}}

  /* Header with waves */
  .hero{
    position:relative; padding:56px 24px 40px; text-align:center;
    background:linear-gradient(180deg, #0d2433 0%, #0b1b27 60%, transparent 100%);
    overflow:hidden;
  }
  .title{font-size:clamp(26px, 4vw, 40px); margin:0 0 8px 0; letter-spacing:.5px}
  .subtitle{color:var(--muted); margin:0 auto; max-width:860px}
  .waves{position:absolute; left:0; right:0; bottom:-1px; pointer-events:none; opacity:.8}
  .reef-band{position:absolute; inset:auto 0 -24px 0; pointer-events:none; opacity:.8}

  /* Main layout */
  .wrap{max-width:1100px; margin:0 auto; padding:28px 20px 64px; display:grid; gap:22px}
  .grid{display:grid; grid-template-columns:1.2fr .8fr; gap:22px}
  @media (max-width:950px){ .grid{grid-template-columns:1fr} }

  .card{
    background:linear-gradient(180deg, #0a1420, #0a1622);
    border:1px solid #1b2a3a; border-radius:var(--radius); padding:18px;
    box-shadow:0 10px 30px #00000040;
  }
  .card h2{margin:0 0 8px 0; font-size:20px}
  .card p{margin:6px 0 14px 0; color:var(--muted)}

  /* Uploader */
  .uploader{
    display:grid; gap:12px; padding:16px; border:1px dashed #2d455a; border-radius:14px; background:#0b1824;
  }
  input[type=file]{width:100%; padding:12px; border-radius:12px; border:1px solid #24384a; background:#0e1d29; color:var(--ink)}
  .row{display:flex; gap:12px; align-items:center; flex-wrap:wrap}
  button{
    appearance:none; border:none; padding:12px 16px; border-radius:12px; font-weight:700; cursor:pointer;
    background:linear-gradient(135deg, var(--accent), var(--accent2)); color:#001018;
    box-shadow:0 10px 26px #2b84ff33; transition:transform .06s ease, filter .2s ease;
  }
  button:active{transform:translateY(1px)}
  button:disabled{opacity:.6; cursor:not-allowed; box-shadow:none}

  .pill{padding:6px 10px; border:1px solid #2a4256; border-radius:999px; color:var(--muted); font-size:12px}

  /* Result + error */
  .result,.error{
    margin-top:12px; padding:12px 14px; border-radius:12px; white-space:pre-wrap; background:#0b1622; border:1px solid #223549;
  }
  .error{border-color:#55292f; color:#ffd6d6}

  /* Gauge */
  .gauge{
    --val: 0; /* 0..100 */
    position:relative; width:220px; height:220px; margin:16px auto;
    border-radius:50%;
    background:
      conic-gradient(
        from -90deg,
        #26e0a8 calc(var(--val)*1%),
        #1a2c3a calc(var(--val)*1%)
      );
    display:grid; place-items:center;
    box-shadow: inset 0 0 40px #00000055, 0 8px 40px #00000055;
  }
  .gauge::after{
    content:"";
    position:absolute; inset:12px;
    border-radius:50%; background:#041019; border:1px solid #173042;
  }
  .gauge .val{
    position:relative; z-index:1; font-size:38px; font-weight:800; letter-spacing:.5px;
  }
  .gauge .tag{position:relative; z-index:1; margin-top:6px; color:var(--muted); font-size:12px}

  .legend{
    display:flex; gap:10px; justify-content:center; margin-top:8px; flex-wrap:wrap; color:var(--muted); font-size:12px
  }
  .dot{width:10px; height:10px; border-radius:50%}
  .d1{background:#26e0a8} .d2{background:#f5c84b} .d3{background:#ff7f50} .d4{background:#ff5151}

  .fact{font-size:13px; color:#9fc7de; background:#0a1a25; border:1px solid #1e384c; border-radius:12px; padding:10px 12px}
  .facts{display:grid; gap:10px}

  .muted{color:var(--muted)}
  .json-preview{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace; font-size:12px; max-height:210px; overflow:auto; background:#07131b; border:1px solid #143044; padding:10px; border-radius:12px}
  .toolbar{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
</style>
</head>
<body>

<!-- gentle bubbles -->
<div class="bubble"></div><div class="bubble"></div><div class="bubble"></div><div class="bubble"></div><div class="bubble"></div>

<header class="hero">
  <h1 class="title">Coral Bleaching Predictor</h1>
  <p class="subtitle">Upload a <strong>.json</strong> payload with reef features (SSTA, TSA, winds, location, etc.). We‚Äôll send it to <code>/predict</code> and visualize the estimated bleaching percentage.</p>

  <!-- waves -->
  <svg class="waves" viewBox="0 0 1440 110" preserveAspectRatio="none" height="110">
    <path d="M0,80 C240,120 480,10 720,60 C960,110 1200,45 1440,90 L1440,110 L0,110 Z" fill="#0b2a3a88"></path>
    <path d="M0,90 C240,130 480,35 720,75 C960,115 1200,55 1440,95 L1440,110 L0,110 Z" fill="#0e3d5688"></path>
  </svg>

  <!-- coral silhouettes -->
  <svg class="reef-band" viewBox="0 0 1440 180" preserveAspectRatio="none" height="180">
    <g fill="#0a2434">
      <path d="M0,180 L0,150 C120,140 220,120 280,135 C360,155 390,175 520,150 C650,125 720,168 810,150 C900,132 970,140 1040,150 C1110,160 1210,165 1440,150 L1440,180 Z"/>
      <g opacity=".8">
        <path d="M120,160 c10,-30 20,-40 30,-35 c8,4 5,12 -4,20 c11,-6 20,-6 23,2 c4,10 -8,19 -49,13z"/>
        <path d="M280,162 c8,-24 16,-32 24,-28 c6,3 4,9 -3,16 c8,-5 15,-5 18,2 c3,8 -6,15 -39,10z"/>
        <path d="M980,158 c10,-28 22,-38 34,-32 c8,4 6,12 -4,19 c12,-6 21,-5 25,3 c4,10 -9,18 -55,10z"/>
        <path d="M1260,164 c9,-26 18,-34 26,-30 c6,3 4,9 -3,15 c9,-4 16,-4 19,2 c3,8 -6,14 -42,13z"/>
      </g>
    </g>
  </svg>
</header>

<main class="wrap">
  <div class="grid">
    <!-- LEFT: uploader + result -->
    <section class="card">
      <h2>Upload JSON ‚Üí Send to <code>/predict</code></h2>
      <p>Exactly one file input (your spec). We parse it in the browser and POST the JSON.</p>

      <div class="uploader">
        <input id="jsonFile" type="file" accept=".json,application/json" />
        <div class="toolbar">
          <button id="submitBtn" disabled>Submit to predict</button>
          <button id="downloadSample">Download sample.json</button>
          <span id="status" class="pill">Waiting for file‚Ä¶</span>
        </div>
        <div id="error" class="error" hidden></div>
        <div class="json-preview" id="preview" hidden></div>
      </div>

      <div style="display:grid; place-items:center; margin-top:8px;">
        <div class="gauge" id="gauge" style="--val:0">
          <div class="val" id="gaugeVal">0%</div>
          <div class="tag">Predicted Bleaching</div>
        </div>
        <div class="legend">
        </div>
      </div>

      <div id="result" class="result" hidden></div>
    </section>

    <!-- RIGHT: ocean facts / tips -->
    <aside class="card">
      <h2>Reef Tips & Context</h2>
      <div class="facts">
        <div class="fact">üìÖ <strong>Seasonality</strong> matters: peak thermal anomalies cluster in warm seasons for each ecoregion.</div>
        <div class="fact">üìç <strong>Location features</strong> like <code>Latitude_Degrees</code>, <code>Longitude_Degrees</code>, and <code>ClimSST</code> help the model learn regional baselines.</div>
      </div>
    </aside>
  </div>
</main>

<script>
  const fileInput = document.getElementById('jsonFile');
  const submitBtn = document.getElementById('submitBtn');
  const statusEl = document.getElementById('status');
  const previewEl = document.getElementById('preview');
  const resultEl = document.getElementById('result');
  const errorEl  = document.getElementById('error');
  const gauge = document.getElementById('gauge');
  const gaugeVal = document.getElementById('gaugeVal');
  const downloadSample = document.getElementById('downloadSample');

  let fileOk = false;
  let jsonCache = null;

  // Sample JSON (matches your schema vibe)
  const sample = {
    "Data_Source": "NOAA",
    "Latitude_Degrees": 12.34,
    "Longitude_Degrees": 56.78,
    "Ocean_Name": "Atlantic Ocean",
    "Realm_Name": "Tropical Atlantic",
    "Ecoregion_Name": "Caribbean",
    "Country_Name": "SomeCountry",
    "State_Island_Province_Name": "SomeState",
    "City_Town_Name": "SomeCity",
    "Site_Name": "SomeSite",
    "Distance_to_Shore": "5 km",
    "Exposure": "Exposed",
    "Turbidity": "Low",
    "Cyclone_Frequency": 0.3,
    "Date_Day": 1,
    "Date_Month": 7,
    "Date_Year": 2020,
    "Depth_m": "4",
    "Substrate_Name": "Reef",
    "Percent_Cover": "35",
    "ClimSST": "28.2",
    "Temperature_Kelvin": "300.1",
    "Temperature_Mean": "29.5",
    "Temperature_Minimum": "27.8",
    "Temperature_Maximum": "31.2",
    "Temperature_Kelvin_Standard_Deviation": "0.6",
    "Windspeed": "5.3",
    "SSTA": "0.8",
    "SSTA_Standard_Deviation": "0.2",
    "SSTA_Mean": "0.6",
    "SSTA_Minimum": "0.1",
    "SSTA_Maximum": "1.5",
    "SSTA_Frequency": "3",
    "SSTA_Frequency_Standard_Deviation": "0.7",
    "SSTA_FrequencyMax": "6",
    "SSTA_FrequencyMean": "2.5",
    "SSTA_DHW": "4.1",
    "SSTA_DHW_Standard_Deviation": "1.2",
    "SSTA_DHWMax": "6.4",
    "SSTA_DHWMean": "3.0",
    "TSA": "0.9",
    "TSA_Standard_Deviation": "0.3",
    "TSA_Minimum": "0.2",
    "TSA_Maximum": "1.6",
    "TSA_Mean": "0.7",
    "TSA_Frequency": "2",
    "TSA_Frequency_Standard_Deviation": "0.4",
    "TSA_FrequencyMax": "5",
    "TSA_FrequencyMean": "1.8",
    "TSA_DHW": "3.7",
    "TSA_DHW_Standard_Deviation": "0.9",
    "TSA_DHWMax": "5.2",
    "TSA_DHWMean": "2.6",
    "Date": "2020-07-01",
    "Year": 2020,
    "Month": 7,
    "DayOfYear": 183,
    "sin_doy": 0.1,
    "cos_doy": -0.99,
    "SSTA_x_Turbidity": 0.3,
    "SSTA_x_Wind": 0.24,
    "ClimSST_x_Wind": 149.46,
    "Lat_x_Lon": 700.0
  };

  downloadSample.addEventListener('click', () => {
    const blob = new Blob([JSON.stringify(sample, null, 2)], {type: 'application/json'});
    const url = URL.createObjectURL(blob);
    const a = Object.assign(document.createElement('a'), { href:url, download:'sample.json' });
    document.body.appendChild(a); a.click(); a.remove();
    URL.revokeObjectURL(url);
  });

  function resetUI(){
    resultEl.hidden = true; errorEl.hidden = true; previewEl.hidden = true;
    previewEl.textContent = ''; resultEl.textContent = '';
    statusEl.textContent = 'Waiting for file‚Ä¶';
    setGauge(0);
  }

  function setGauge(value){ // clamp & color thresholds
    const v = Math.max(0, Math.min(100, Number(value) || 0));
    gauge.style.setProperty('--val', v);
    gaugeVal.textContent = v.toFixed(1) + '%';
    // You can map severity color if you like; we keep the gradient simple
  }

  fileInput.addEventListener('change', async () => {
    resetUI();
    const f = fileInput.files?.[0];
    if(!f){ submitBtn.disabled = true; return; }
    if(f.size > 2*1024*1024){ // 2MB
      showError("File too large (max 2MB)."); submitBtn.disabled = true; return;
    }
    const ok = /\.json$/i.test(f.name) || f.type === 'application/json' || f.type === '';
    if(!ok){ showError("Please select a JSON file."); submitBtn.disabled = true; return; }

    try{
      const text = await f.text();
      jsonCache = JSON.parse(text);
      previewEl.hidden = false;
      previewEl.textContent = JSON.stringify(jsonCache, null, 2);
      statusEl.textContent = `Ready: ${f.name}`;
      submitBtn.disabled = false;
    }catch(e){
      showError("Invalid JSON: " + e.message);
      submitBtn.disabled = true;
    }
  });

submitBtn.addEventListener('click', async () => {
    const f = fileInput.files?.[0];
    if (!f) return;

    resultEl.hidden = true; errorEl.hidden = true;
    submitBtn.disabled = true; statusEl.textContent = 'Uploading file to /predict_file‚Ä¶';

    try{
      const fd = new FormData();
      fd.append('file', f, f.name); 

      const resp = await fetch('/predict', {
        method:'POST',
        body: fd 
      });

      const data = await resp.json().catch(()=> ({}));
      if(!resp.ok){
        const detail = data?.detail ?? resp.statusText;
        throw new Error(`Server error (${resp.status}): ${detail}`);
      }

      resultEl.textContent = data
      statusEl.textContent = 'Done';

      setGauge(data);
    }catch(err){
      showError(err.message || String(err));
      statusEl.textContent = '';
      setGauge(0);
    }finally{
      submitBtn.disabled = false;
    }
  });

  function showError(msg){
    resultEl.hidden = true; errorEl.hidden = false; errorEl.textContent = msg;
  }
</script>
</body>
</html>
    